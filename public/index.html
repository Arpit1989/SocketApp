<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="#">

    <title>Jazmine</title>

    <!-- Bootstrap core CSS -->

    <!-- Custom styles for this template -->
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="http://jazmine.co.in/style.css">-->
    <link rel="stylesheet" href="style.css">


</head>
<body>
    <div class="cover-container">
            <div class="masthead clearfix">
                <div class="inner">
                    <h3 onclick="location.reload();" class="masthead-brand" style="background-color: #333333;color: wheat;">Jazmine<image src="Jazmine_head.png" style="width: 2.0em"></image></h3>
                    <nav>
                        <ul class="nav masthead-nav">

                            <li class="active"><a onclick="navigate(this);" href="#">Home <span class="glyphicon glyphicon-star" aria-hidden="true"></span></a></li>
                            <li><a onclick="navigate(this);" href="#">Features <sup style="color: #a03808">inside chat! </sup><span class="glyphicon glyphicon-piggy-bank" aria-hidden="true"></span></a></li>
                            <li><a onclick="navigate(this);" href="#">Contact <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> </a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="inner cover page-1">
                <ul class="pages">
                    <li class="login page">
                        <div style="margin-top: 4em;" class="form">
                            <h4 class="title" style="color: khaki;"> Choose your nickname? </h4>
                            <input class="usernameInput" type="text" maxlength="14" placeholder="Press Enter" />
                            <h4 class="title" style="color: khaki;">Enter the Room</h4>
                            <input class="roomnameInput" type="text" maxlength="14" placeholder="Press Enter" />
                            <span style="font-size: 1.2em;color: khaki" >Or Join Rooms (No. of Users)</span>
                            <div class="row">
                                <div class="col-md-4">
                                    <ul style="padding-left: 0em" class="suggestedRooms">
                                        <li onclick="peopleNearMe()" style="padding-top: 1em;;cursor:pointer;background-color: #007A00">People Near Me <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></li>
                                        <li onclick="peopleNotSoNearMe()" style="padding-top: 1em;;cursor:pointer;background-color: #D83647">People Not So near ME <span class="glyphicon glyphicon-plane" aria-hidden="true"></span></li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <ul style="padding-left: 0em" class="suggestedRooms">
                                        <li onclick="trustYourDestiny()" style="padding-top: 1em;;cursor: pointer;background-color: #19469D">Trust Your Destiny <span class="glyphicon glyphicon-globe" aria-hidden="true"></span></li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <ul style="padding-left: 0em" class="suggestedRooms" id="roomNames">

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="chat page">
                        <div class="chatArea">
                            <a class="changeRoom" onclick="location.reload()" href="#"><span onclick="location.reload()" class="glyphicon glyphicon-refresh" aria-hidden="true"></span></a>
                            <ul class="messages"></ul>
                        </div>
                        <input class="inputMessage" placeholder="Type here..."/>
                        <input class="myInput" id="myInput" hidden="true" />
                    </li>
                    <iframe id="sc-widget" src="https://w.soundcloud.com/player/?url=http://api.soundcloud.com/users/107767142/favorites" width="100%" height="1" scrolling="no" frameborder="no"></iframe>
                    </ul>

            </div>

            <div class="inner cover page-2">
                <h3 class="cover-heading" style="color: wheat;">Features </h3>

                <div class="row" style="margin-top: 40px">
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                            <img id="jazmine" src="Jazmine.png" alt="Jazmine">
                            <div class="caption">
                                <h3 style="color: azure">Virtual Assitant </h3>
                                <p style="color: azure">Ask Jazmine Anything like @who is Spider Man , @where is Panama Canal or @what is time dilation ... By enabling the microPhone , say "Baby what is gum bacteria" or "Baby who are romans"</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                            <iframe allowtransparency="true" scrolling="no" frameborder="no" src="https://w.soundcloud.com/icon/?url=http%3A%2F%2Fsoundcloud.com%2Fundefined&color=orange_white&size=64" style="width: 64px; height: 64px;"></iframe>
                            <div class="caption">
                                <h3 style="color: azure">Music & Genre</h3>
                                <p style="color: azure">By Typing Amaze me , It will play tops songs from Soundcloud. to change the song type "play next" or "play previous"</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                          <img id="youTube" src="youtube.png" alt="YouTube">
                          <div class="caption">
                             <h3 style="color: azure">Youtube Videos</h3>
                             <p style="color: azure">Share Videos to everyone in the room by "* your_desired_video_name" e.g "* how was earth formed"</p>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                            <img style="width: 22%;" src="wikipedia.png" alt="Wikipedia">
                            <div class="caption">
                                <h3 style="color: azure">Wikipedia</h3>
                                <p style="color: azure">asdasdasd asda sdasda s adasd asd asd asd a dsad asdas dasd asdasd asdasd asd asda sdas dsa</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                            <img style="width: 20%;" src="openweather.png" alt="Open Weather">
                            <div class="caption">
                                <h3 style="color: azure">Weather Updates</h3>
                                <p style="color: azure">You can also ask sam for weather , simple maths , root words of English words</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-md-4">
                        <div style="background-color: #333;border: 1px solid #333;" class="thumbnail">
                            <img style="width: 37%;" src="comingsoon.png" alt="Coming Soon">
                            <div class="caption">
                                <h3 style="color: azure">Coming Soon </h3>
                                <p style="color: azure">asdasdasd asda sdasda s adasd asd asd asd a dsad asdas dasd asdasd asdasd asd asda sdas dsa</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="inner cover page-3">
                <h1 class="cover-heading" style="color: wheat;">Contact</h1>
                <ul style="padding: 1em 0em 0em 0em;">
                    <li id="contactpage" ><h2 class="well well-lg" style="color: #333333;font-size: 14px;"> For any feedback and suggestion , Please drop a mail to <a style="color: #333333" href="mailto:speak2arpit@gmail.com" target="_top">speak2arpit@gmail.com</a></h2></li>
                </ul>

            </div>
        </div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="jquery-1.10.2.min.js"></script>
    <script src="api.js" type="text/javascript"></script>
    <script type="text/javascript">


        $(document).ready(function(){
            $('#sc-widget').css('visibility','hidden');
//            var roomName = window.location.href.split("/")
//            $('.roomnameInput').val(roomName[roomName.length-1]);

            // Navigation Panel
            var $page1 = $(".page-1");
            var $page2 = $(".page-2");
            var $page3 = $(".page-3");
            $page2.hide();
            $page1.show();
            $page3.hide();

            navigate = function(nav){
                $('.nav,.masthead-nav').find('li').each(function(index){
                    $($('.nav,.masthead-nav').find('li')[index]).removeClass("active");

                })
                $(nav).parent().addClass("active");
                if ($(nav).text() == "Features inside chat! "){
                    $page1.hide();
                    $page2.show();
                    $page3.hide();
                }else if($(nav).text() == "Contact  "){
                    $page1.hide();
                    $page3.show();
                    $page2.hide();
                }else if($(nav).text() == "Change Room"){
                    location.reload();
                } else {
                    $page2.hide();
                    $page1.show();
                    $page3.hide();

                }
            }
        });


        (function(){

            var widgetIframe = document.getElementById('sc-widget'),

                    widget       = SC.Widget(widgetIframe);

            widget.bind(SC.Widget.Events.READY, function() {
                widget.bind(SC.Widget.Events.PLAY, function() {
                    // get information about currently playing sound
                    widget.getCurrentSound(function(currentSound) {
                    });
                });
                // get current level of volume
                widget.getVolume(function(volume) {
                });

                // set new volume level
                // get the value of the current position
            });

        }());

    </script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="responsivevoice.js"></script>
<!--<script src="http://localhost:3001/responsivevoice.js"></script>-->

<script type="text/javascript" src="http://cdn.socket.io/socket.io-1.0.3.js"></script>
<script src="main.js"></script>
<!--<script src="main.js"></script>-->

    <script>//! annyang
    //! version : 1.6.0
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://www.TalAter.com/annyang/
(function(a){"use strict";var b=this,c=b.SpeechRecognition||b.webkitSpeechRecognition||b.mozSpeechRecognition||b.msSpeechRecognition||b.oSpeechRecognition;if(!c)return b.annyang=null,a;var d,e,f=[],g={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},h=0,i=!1,j="font-weight: bold; color: #00f;",k=!1,l=/\s*\((.*?)\)\s*/g,m=/(\(\?:[^)]+\))\?/g,n=/(\(\?)?:\w+/g,o=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#]/g,q=function(a){return a=a.replace(p,"\\$&").replace(l,"(?:$1)?").replace(n,function(a,b){return b?a:"([^\\s]+)"}).replace(o,"(.*?)").replace(m,"\\s*$1?\\s*"),new RegExp("^"+a+"$","i")},r=function(a){a.forEach(function(a){a.callback.apply(a.context)})},s=function(){t()||b.annyang.init({},!1)},t=function(){return d!==a};b.annyang={init:function(l,m){m=m===a?!0:!!m,d&&d.abort&&d.abort(),d=new c,d.maxAlternatives=5,d.continuous="http:"===b.location.protocol,d.lang="en-US",d.onstart=function(){r(g.start)},d.onerror=function(a){switch(r(g.error),a.error){case"network":r(g.errorNetwork);break;case"not-allowed":case"service-not-allowed":e=!1,r((new Date).getTime()-h<200?g.errorPermissionBlocked:g.errorPermissionDenied)}},d.onend=function(){if(r(g.end),e){var a=(new Date).getTime()-h;1e3>a?setTimeout(b.annyang.start,1e3-a):b.annyang.start()}},d.onresult=function(a){if(k)return i&&b.console.log("Speech heard, but annyang is paused"),!1;r(g.result);for(var c,d=a.results[a.resultIndex],e=0;e<d.length;e++){c=d[e].transcript.trim(),i&&b.console.log("Speech recognized: %c"+c,j);for(var h=0,l=f.length;l>h;h++){var m=f[h].command.exec(c);if(m){var n=m.slice(1);return i&&(b.console.log("command matched: %c"+f[h].originalPhrase,j),n.length&&b.console.log("with parameters",n)),f[h].callback.apply(this,n),r(g.resultMatch),!0}}}return r(g.resultNoMatch),!1},m&&(f=[]),l.length&&this.addCommands(l)},start:function(c){k=!1,s(),c=c||{},e=c.autoRestart!==a?!!c.autoRestart:!0,c.continuous!==a&&(d.continuous=!!c.continuous),h=(new Date).getTime();try{d.start()}catch(f){i&&b.console.log(f.message)}},abort:function(){e=!1,t&&d.abort()},pause:function(){k=!0},resume:function(){b.annyang.start()},debug:function(a){i=arguments.length>0?!!a:!0},setLanguage:function(a){s(),d.lang=a},addCommands:function(a){var c,d;s();for(var e in a)if(a.hasOwnProperty(e)){if(c=b[a[e]]||a[e],"function"!=typeof c)continue;d=q(e),f.push({command:d,callback:c,originalPhrase:e})}i&&b.console.log("Commands successfully loaded: %c"+f.length,j)},removeCommands:function(b){return b===a?void(f=[]):(b=Array.isArray(b)?b:[b],void(f=f.filter(function(a){for(var c=0;c<b.length;c++)if(b[c]===a.originalPhrase)return!1;return!0})))},addCallback:function(c,d,e){if(g[c]!==a){var f=b[d]||d;"function"==typeof f&&g[c].push({callback:f,context:e||this})}}}}).call(this);</script>
<script>


    var sendSamantha = function(term){
        console.log(term);
        $('.myInput').val(term);
        $( ".myInput" ).trigger( "change" );
    }

    if (annyang) {
        // Let's define our first command. First the text we expect, and then the function it should call
        var commands = {
            'baby *term' : sendSamantha

        };

        // Add our commands to annyang
        annyang.addCommands(commands);

        // Start listening. You can call this here, or attach this call to an event, button, etc.
        annyang.start({ autoRestart: true,continuous: true });
    }


</script>
<script>
    app.initialize();
    document.addEventListener('deviceready', function() {
            var FADE_TIME = 150; // ms
            var TYPING_TIMER_LENGTH = 400; // ms
            var COLORS = [
                '#e21400', '#91580f', '#f8a700', '#f78b00',
                '#58dc00', '#287b00', '#a8f07a', '#4ae8c4',
                '#3b88eb', '#3824aa', '#a700ff', '#d300e7'
            ];
            // Initialize varibles
            var $server = "http://52.10.37.93:3000";
            //var $server = "http://localhost:3000";
            var $window = $(window);
            var $usernameInput = $('.usernameInput'); // Input for username
            var $messages = $('.messages'); // Messages area
            var $inputMessage = $('.inputMessage'); // Input message input box
            var $myInput = $('.myInput');
            var $roomName = $('.roomnameInput'); //RoomName
            var $iframe = $('#sc-widget')[0];

            var widget = SC.Widget($iframe);
            var $loginPage = $('.login.page'); // The login page
            var $chatPage = $('.chat.page'); // The chatroom page

            var $roomsAvailable = $('#roomNames')
            // Prompt for setting a username
            var username;
            var connected = false;
            var typing = false;
            var lastTypingTime;
            var $currentInput ;
            var virtual_girl = 'Jazmine';
            //var socket = io();
            var socket = io.connect("http://52.10.37.93:8080");


            $myInput.change(function(){
                $.ajax({
                    url: $server,
                    dataType: 'jsonp',
                    jsonpCallback: 'jsonCallback',
                    crossDomain: true,
                    data: {ques: $myInput.val()},
                    success: (function( msg ) {
                        console.log(msg);
                        var msgs = msg;
                        if (typeof msgs.say == "string"){
                            var vMessage = msg.say
                        }else{
                            var vMessage = msg.say[Object.getOwnPropertyNames(msg.say)[0]];
                        }

                        if (vMessage == "error"){
                            var message = $myInput.val();
                            if (message.match(/amaze me/i) != null){
                                if ((message.match(/amaze me/i) !== 'undefined') && (message.match(/amaze me/i).length > 0 )) {
                                    socket.emit('play_music', {setVolume: 100,prev:false, play:true, next: false,pause:false});
                                    widget.setVolume(100);
                                    widget.skip(Math.floor((Math.random() * 56) + 1));
                                    widget.play();
                                }
                            } else if (message.match(/play some music/i) != null){
                                if ((message.match(/play some music/i) !== 'undefined') && (message.match(/play some music/i).length > 0 )) {
                                    socket.emit('play_music',  {setVolume: 100,prev:false, play:true, next: false,pause:false});
                                    widget.setVolume(100);
                                    widget.play();
                                }
                            } else if (message.match(/play next/i) != null){
                                if ((message.match(/play next/i) !== 'undefined') && (message.match(/play next/i).length > 0 )) {
                                    socket.emit('play_music', {setVolume: 100,prev:false, play:false, next: true,pause:false});
                                    widget.setVolume(100);
                                    widget.next();
                                }
                            } else if (message.match(/play previous/i) != null){
                                if ((message.match(/play previous/i) !== 'undefined') && (message.match(/play previous/i).length > 0 )) {
                                    socket.emit('play_music',  {setVolume: 100,prev:true, play:false, next: false,pause:false});
                                    widget.setVolume(100);
                                    widget.prev();
                                }
                            } else if (message.match(/pause/i) != null){
                                if ((message.match(/pause/i) !== 'undefined') && (message.match(/pause/i).length > 0 )) {
                                    socket.emit('play_music',  {setVolume: 100,prev:false, play:false, next: false,pause:true});
                                    widget.setVolume(100);
                                    widget.pause();
                                }
                            }
                        } else {

                            addChatMessage({
                                username: virtual_girl,
                                message: vMessage
                            })
                            socket.emit('new message', { username: virtual_girl ,message: vMessage,youtube: false});
                        }
                    })
                });



                addChatMessage({
                    username: $usernameInput.val().trim(),
                    message: $myInput.val()
                })
            });
            function addParticipantsMessage (data) {
                var message = '';
                if (data.numUsers === 1) {
                    message += "there's 1 participant in "+ data.room;
                } else {
                    message += "there are " + data.numUsers + " participants in "+ data.room;
                }
                log(message);
            }

            // Sets the client's username
            function setUsername () {
                username = cleanInput($usernameInput.val().trim());
                roomname = cleanInput($roomName.val().trim());
                // If the username is valid
                if (username) {
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                }
            }

            function ask_sam(message){
                if (message.match(/@/g) != null){
                    if ((typeof message.match(/@/g) !== 'undefined') && (message.match(/@/g).length > 0)) {
                        $.ajax({
                            url: $server,
                            dataType: 'jsonp',
                            jsonpCallback: 'jsonCallback',
                            crossDomain: true,
                            data: { ques: message.replace("@", "")},
                            success: (function( msg ) {
                                var msgs = msg;
                                if (typeof msgs.say == "string"){
                                    var val = msg.say
                                }else{
                                    var val = msgs.say[Object.getOwnPropertyNames(msgs.say)[0]];
                                }
                                addChatMessage({
                                    username: virtual_girl,
                                    message: val
                                })
                                socket.emit('new message', { username: virtual_girl ,message: val, youtube: false});
                            })
                        });
                    }
                } else if (message.match(/amaze me/i) != null){
                    if ((message.match(/amaze me/i) !== 'undefined') && (message.match(/amaze me/i).length > 0 )) {
                        socket.emit('play_music', {setVolume: 100,prev:false, play:true, next: false,pause:false});

                        widget.setVolume(100);
                        widget.skip(Math.floor((Math.random() * 56) + 1));
                        widget.play();
                    }
                } else if (message.match(/play some music/i) != null){
                    if ((message.match(/play some music/i) !== 'undefined') && (message.match(/play some music/i).length > 0 )) {
                        socket.emit('play_music',  {setVolume: 100,prev:false, play:true, next: false,pause:false});
                        widget.setVolume(100);
                        widget.play();
                    }
                } else if (message.match(/play next/i) != null){
                    if ((message.match(/play next/i) !== 'undefined') && (message.match(/play next/i).length > 0 )) {
                        socket.emit('play_music', {setVolume: 100,prev:false, play:false, next: true,pause:false});
                        widget.setVolume(100);
                        widget.next();
                    }
                } else if (message.match(/play previous/i) != null){
                    if ((message.match(/play previous/i) !== 'undefined') && (message.match(/play previous/i).length > 0 )) {
                        socket.emit('play_music',  {setVolume: 100,prev:true, play:false, next: false,pause:false});
                        widget.setVolume(100);
                        widget.prev();
                    }
                } else if (message.match(/pause/i) != null){
                    if ((message.match(/pause/i) !== 'undefined') && (message.match(/pause/i).length > 0 )) {
                        socket.emit('play_music',  {setVolume: 100,prev:false, play:false, next: false,pause:true});
                        widget.setVolume(100);
                        widget.pause();
                    }
                }

            }
            // Sends a chat message
            function sendMessage () {
                var message = $inputMessage.val();
                // Prevent markup from being injected into the message
                message = cleanInput(message);
                // if there is a non-empty message and a socket connection
                if (message && connected) {
                    $inputMessage.val('');
                    if (message.match(/^\*/g) != null){
                        query = message.replace("*","");
                        console.log(query);
                        var url = "https://www.googleapis.com/youtube/v3/search?part=snippet&&order_by=rating&&q="+query+"&&type=video&key=AIzaSyDRpnBif-8GCtc4E5DOcLXe2aDBVsdY6BQ";
                        console.log(url);
                        $.ajax({
                            url: url,
                            crossDomain: true
                        })
                                .done(function( msg ) {
                                    addChatMessage({
                                        username: username,
                                        youtube: true,
                                        videoId: msg.items[0].id.videoId
                                    });
                                });
                        socket.emit('new message', { username: username ,message: query,youtube: true});
                    } else if(message.match(/f\*\*dsam/g) != null){
                        var feed_data = JSON.parse(message)["f**dsam"]
                        socket.emit('feed data', feed_data);
                    } else {
                        ask_sam(message);
                        addChatMessage({
                            username: username,
                            message: message
                        });
                        // tell server to execute 'new message' and send along one parameter
                        socket.emit('new message', message);
                    }
                }
            }

            // Log a message
            function log (message, options) {
                var $el = $('<li>').addClass('log').text(message);
                addMessageElement($el, options);
            }

            // Adds the visual chat message to the message list
            function addChatMessage (data, options) {
                // Don't fade the message in if there is an 'X was typing'
                var $typingMessages = getTypingMessages(data);
                options = options || {};
                if ($typingMessages.length !== 0) {
                    options.fade = false;
                    $typingMessages.remove();
                }
                if (data.youtube == true){
                    var src = "http://www.youtube.com/embed/"+data.videoId+"?autoplay=1";
                    var $usernameDiv = $('<span class="username"/>')
                            .text(data.username)
                            .css('color', getUsernameColor(data.username));
                    var $messageBodyDiv = $('<iframe width="100%" height="100%" src='+src+'></iframe>');
                    var typingClass = data.typing ? 'typing' : '';
                    var $messageDiv = $('<li class="message"/>')
                            .data('username', data.username)
                            .addClass(typingClass)
                            .append($usernameDiv, $messageBodyDiv);

                    addMessageElement($messageDiv, options);
                } else {
                    if (data.username == virtual_girl){

                        responsiveVoice.speak(String(data.message.trim()));
                        var widgetIframe = document.getElementById('sc-widget'),
                                widget = SC.Widget(widgetIframe);
                        if(responsiveVoice.isPlaying()) {
                            widget.setVolume(0.25);
                        }else{
                            widget.setVolume(100);
                        }
                    }
                    var $usernameDiv = $('<span class="username"/>')
                            .text(data.username)
                            .css('color', getUsernameColor(data.username));
                    var $messageBodyDiv = $('<span style="font-size: 1.1em" class="messageBody">')
                            .text(data.message);

                    var typingClass = data.typing ? 'typing' : '';
                    var $messageDiv = $('<li class="message" style="text-align: left;"/>')
                            .data('username', data.username)
                            .addClass(typingClass)
                            .append($usernameDiv, $messageBodyDiv);

                    addMessageElement($messageDiv, options);
                }
            }

            // Adds the visual chat typing message
            function addChatTyping (data) {
                data.typing = true;
                data.message = 'is typing';
                addChatMessage(data);
            }

            // Removes the visual chat typing message
            function removeChatTyping (data) {
                getTypingMessages(data).fadeOut(function () {
                    $(this).remove();
                });
            }

            // Adds a message element to the messages and scrolls to the bottom
            // el - The element to add as a message
            // options.fade - If the element should fade-in (default = true)
            // options.prepend - If the element should prepend
            //   all other messages (default = false)
            function addMessageElement (el, options) {
                var $el = $(el);

                // Setup default options
                if (!options) {
                    options = {};
                }
                if (typeof options.fade === 'undefined') {
                    options.fade = true;
                }
                if (typeof options.prepend === 'undefined') {
                    options.prepend = false;
                }

                // Apply options
                if (options.fade) {
                    $el.hide().fadeIn(FADE_TIME);
                }
                if (options.prepend) {
                    $messages.prepend($el);
                } else {
                    $messages.append($el);
                }
                $messages[0].scrollTop = $messages[0].scrollHeight;
            }

            // Prevents input from having injected markup
            function cleanInput (input) {
                return $('<div/>').text(input).text();
            }

            // Updates the typing event
            function updateTyping () {
                if (connected) {
                    if (!typing) {
                        typing = true;
                        socket.emit('typing');
                    }
                    lastTypingTime = (new Date()).getTime();

                    setTimeout(function () {
                        var typingTimer = (new Date()).getTime();
                        var timeDiff = typingTimer - lastTypingTime;
                        if (timeDiff >= TYPING_TIMER_LENGTH && typing) {
                            socket.emit('stop typing');
                            typing = false;
                        }
                    }, TYPING_TIMER_LENGTH);
                }
            }

            // Gets the 'X is typing' messages of a user
            function getTypingMessages (data) {
                return $('.typing.message').filter(function (i) {
                    return $(this).data('username') === data.username;
                });
            }

            // Gets the color of a username through our hash function
            function getUsernameColor (username) {
                // Compute hash code
                var hash = 7;
                for (var i = 0; i < username.length; i++) {
                    hash = username.charCodeAt(i) + (hash << 5) - hash;
                }
                // Calculate color
                var index = Math.abs(hash % COLORS.length);
                return COLORS[index];
            }

            // Keyboard events

            $window.keydown(function (event) {
                // Auto-focus the current input when a key is typed
//    if (!(event.ctrlKey || event.metaKey || event.altKey)) {
//      $currentInput.focus();
//    }
                // When the client hits ENTER on their keyboard
                if (event.which === 13) {
                    if (username) {
                        sendMessage();
                        socket.emit('stop typing');
                        typing = false;
                    } else {
                        setUsername();
                    }
                }
            });

            $inputMessage.on('input', function() {
                updateTyping();
            });

            // Click events

            // Focus input when clicking anywhere on login page
            $loginPage.click(function () {
                //$currentInput.focus();
            });

            // Focus input when clicking on the message input's border
            $inputMessage.click(function () {
                $inputMessage.focus();
            });

            // Socket events

            // Whenever the server emits 'login', log the login message
            socket.on('login', function (data) {
                connected = true;
                // Display the welcome message
                var message = "Welcome, you are in "+ data.room;
                log(message, {
                    prepend: true
                });
                addParticipantsMessage(data);
            });

            updateRooms = function(data){
                for (var key in Object.keys(data.rooms)) {
                    if ((data.rooms)[Object.keys(data.rooms)[key]].users.length != 0){
                        $roomsAvailable.append(($("<li style=padding-top: 1em;;cursor:pointer;background-color:"+getUsernameColor(Object.keys(data.rooms)[key])+">"+Object.keys(data.rooms)[key] +" <span class='glyphicon glyphicon-user' aria-hidden='true'> </span> <span class='badge'>" +Object.keys((data.rooms[Object.keys(data.rooms)[key]]).users).length+"</span>"+"</li>").bind('click',function(){ updateRoom( this.textContent )})));
                    }
                }

            };
            getLocation = function(){
                $.ajax( {
                    url: '//freegeoip.net/json/',
                    type: 'POST',
                    dataType: 'jsonp',
                    success: function(location) {
                        // example where I update content on the page.
                        window.localStorage.setItem("city", location.city);
                        window.localStorage.setItem("region-code",location.region_code);
                        window.localStorage.setItem("region-name",location.region_name);
                        window.localStorage.setItem("areacode",location.areacode);
                        window.localStorage.setItem("ip",location.ip);
                        window.localStorage.setItem("longitude",location.longitude);
                        window.localStorage.setItem("latitude",location.latitude);
                        window.localStorage.setItem("country-name",location.country_name);
                        window.localStorage.setItem("country-code",location.country_code);
                    }
                });
            };

            socket.on('getRooms',function(data){
                getLocation();
                updateRooms(data);
                var randomRoomName = selectRandomRoom(data);
                window.localStorage.setItem("rooms",randomRoomName);
            });

            selectRandomRoom = function(data){
                var randomRoom;
                for (var key in Object.keys(data.rooms)) {
                    if ((data.rooms)[Object.keys(data.rooms)[key]].users.length != 0){
                        randomRoom = Object.keys(data.rooms)[Math.floor(Math.random()*(Object.keys(data.rooms)).length)];
                    }
                }
                return randomRoom;
            };




            updateRoom = function(newRoom){
                console.log(newRoom);
                var newRoom = newRoom.split("  ")[0];
                username = cleanInput($usernameInput.val().trim());
                roomname = cleanInput(newRoom.trim());
                // If the username is valid
                if (username) {
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                }else{
                    username = "Anonymous User "
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);
                }
            };
            peopleNearMe = function(){
                var newRoom = window.localStorage.getItem("city");
                if (newRoom == ""){
                    newRoom = window.localStorage.getItem("country-name");
                }
                username = cleanInput($usernameInput.val().trim());
                roomname = cleanInput(newRoom.trim());
                // If the username is valid
                console.log(roomname);
                if (username) {
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                } else {
                    username = "Anonymous User "
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                }
            };

            trustYourDestiny = function(){
                var newRoom = window.localStorage.getItem("rooms");
                username = cleanInput($usernameInput.val().trim());
                roomname = cleanInput(newRoom.trim());
                // If the username is valid
                if (username) {
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                } else {
                    username = "Anonymous User "
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                }
            };

            peopleNotSoNearMe = function(){
                var newRoom = window.localStorage.getItem("region-name");
                if (newRoom == ""){
                    newRoom = window.localStorage.getItem("country-name");
                }
                username = cleanInput($usernameInput.val().trim());
                roomname = cleanInput(newRoom.trim());
                // If the username is valid
                if (username) {
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                } else {
                    username = "Anonymous User"
                    $loginPage.fadeOut();
                    $chatPage.show();
                    $loginPage.off('click');
                    $currentInput = $inputMessage.focus();

                    // Tell server the room name
                    socket.emit('setRoom',roomname);
                    // Tell the server your username
                    socket.emit('add user', username);

                }
            }

            socket.on('play_music',function(data){
                console.log(data);
                if (data.play == true){
                    widget.setVolume(data.setVolume);
                    widget.play();
                }else if (data.next == true){
                    widget.setVolume(data.setVolume);
                    widget.next();
                }else if (data.prev == true){
                    widget.setVolume(data.setVolume);
                    widget.prev();
                }else if (data.pause == true){
                    widget.setVolume(data.setVolume);
                    widget.pause();
                }else{
                    widget.setVolume(data.setVolume);
                    widget.pause();
                }
            })
            // Whenever the server emits 'new message', update the chat body
            socket.on('new message', function (data) {
                addChatMessage(data);
            });

            // Whenever the server emits 'user joined', log it in the chat body
            socket.on('user joined', function (data) {
                log(data.username + ' joined ' + data.room);
                addParticipantsMessage(data);
            });

            // Whenever the server emits 'user left', log it in the chat body
            socket.on('user left', function (data) {
                log(data.username + ' left ' + data.room);
                if (data.numUsers == 0){
                    window.localStorage.removeItem(data.room);
                }
                addParticipantsMessage(data);
                removeChatTyping(data);
            });

            // Whenever the server emits 'typing', show the typing message
            socket.on('typing', function (data) {
                addChatTyping(data);
            });

            // Whenever the server emits 'stop typing', kill the typing message
            socket.on('stop typing', function (data) {
                removeChatTyping(data);
            });
    });
</script>
</body>
</html>