$(function(){var m=150;var j=400;var t=["#e21400","#91580f","#f8a700","#f78b00","#58dc00","#287b00","#a8f07a","#4ae8c4","#3b88eb","#3824aa","#a700ff","#d300e7"];var E="http://52.10.37.93:3000";var w=$(window);var a=$(".usernameInput");var d=$(".messages");var z=$(".inputMessage");var y=$(".myInput");var f=$(".roomnameInput");var v=$("#sc-widget")[0];var h=SC.Widget(v);var e=$(".login.page");var H=$(".chat.page");var C=$("#roomNames");var i;var I=false;var G=false;var B;var c;var l="Jazmine";var s=io.connect("http://52.10.37.93:8080");y.change(function(){$.ajax({url:E,dataType:"jsonp",jsonpCallback:"jsonCallback",crossDomain:true,data:{ques:y.val()},success:(function(M){var L=M;if(typeof L.say=="string"){var J=M.say}else{var J=M.say[Object.getOwnPropertyNames(M.say)[0]]}if(J=="error"){var K=y.val();if(K.match(/amaze me/i)!=null){if((K.match(/amaze me/i)!=="undefined")&&(K.match(/amaze me/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:true,next:false,pause:false});h.setVolume(100);h.skip(Math.floor((Math.random()*56)+1));h.play()}}else{if(K.match(/play some music/i)!=null){if((K.match(/play some music/i)!=="undefined")&&(K.match(/play some music/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:true,next:false,pause:false});h.setVolume(100);h.play()}}else{if(K.match(/play next/i)!=null){if((K.match(/play next/i)!=="undefined")&&(K.match(/play next/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:false,next:true,pause:false});h.setVolume(100);h.next()}}else{if(K.match(/play previous/i)!=null){if((K.match(/play previous/i)!=="undefined")&&(K.match(/play previous/i).length>0)){s.emit("play_music",{setVolume:100,prev:true,play:false,next:false,pause:false});h.setVolume(100);h.prev()}}else{if(K.match(/pause/i)!=null){if((K.match(/pause/i)!=="undefined")&&(K.match(/pause/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:false,next:false,pause:true});h.setVolume(100);h.pause()}}}}}}}else{u({username:l,message:J});s.emit("new message",{username:l,message:J,youtube:false})}})});u({username:a.val().trim(),message:y.val()})});function D(K){var J="";if(K.numUsers===1){J+="there's 1 participant in "+K.room}else{J+="there are "+K.numUsers+" participants in "+K.room}n(J)}function r(){i=p(a.val().trim());roomname=p(f.val().trim());if(i){e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}}function q(J){if(J.match(/@/g)!=null){if((typeof J.match(/@/g)!=="undefined")&&(J.match(/@/g).length>0)){$.ajax({url:E,dataType:"jsonp",jsonpCallback:"jsonCallback",crossDomain:true,data:{ques:J.replace("@","")},success:(function(M){var K=M;if(typeof K.say=="string"){var L=M.say}else{var L=K.say[Object.getOwnPropertyNames(K.say)[0]]}u({username:l,message:L});s.emit("new message",{username:l,message:L,youtube:false})})})}}else{if(J.match(/amaze me/i)!=null){if((J.match(/amaze me/i)!=="undefined")&&(J.match(/amaze me/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:true,next:false,pause:false});h.setVolume(100);h.skip(Math.floor((Math.random()*56)+1));h.play()}}else{if(J.match(/play some music/i)!=null){if((J.match(/play some music/i)!=="undefined")&&(J.match(/play some music/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:true,next:false,pause:false});h.setVolume(100);h.play()}}else{if(J.match(/play next/i)!=null){if((J.match(/play next/i)!=="undefined")&&(J.match(/play next/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:false,next:true,pause:false});h.setVolume(100);h.next()}}else{if(J.match(/play previous/i)!=null){if((J.match(/play previous/i)!=="undefined")&&(J.match(/play previous/i).length>0)){s.emit("play_music",{setVolume:100,prev:true,play:false,next:false,pause:false});h.setVolume(100);h.prev()}}else{if(J.match(/pause/i)!=null){if((J.match(/pause/i)!=="undefined")&&(J.match(/pause/i).length>0)){s.emit("play_music",{setVolume:100,prev:false,play:false,next:false,pause:true});h.setVolume(100);h.pause()}}}}}}}}function g(){var K=z.val();K=p(K);if(K&&I){z.val("");if(K.match(/^\*/g)!=null){query=K.replace("*","");var J="https://www.googleapis.com/youtube/v3/search?part=snippet&&order_by=rating&&q="+query+"&&type=video&key=AIzaSyDRpnBif-8GCtc4E5DOcLXe2aDBVsdY6BQ";$.ajax({url:J,crossDomain:true}).done(function(M){u({username:i,youtube:true,videoId:M.items[0].id.videoId})});s.emit("new message",{username:i,message:query,youtube:true})}else{if(K.match(/f\*\*dsam/g)!=null){var L=JSON.parse(K)["f**dsam"];s.emit("feed data",L)}else{q(K);u({username:i,message:K});s.emit("new message",K)}}}}function n(L,J){var K=$("<li>").addClass("log").text(L);k(K,J)}function u(L,S){var P=x(L);S=S||{};if(P.length!==0){S.fade=false;P.remove()}if(L.youtube==true){var J="http://www.youtube.com/embed/"+L.videoId+"?autoplay=1";var O=$('<span class="username"/>').text(L.username).css("color",b(L.username));var Q=$('<iframe width="100%" height="100%" src='+J+"></iframe>");var K=L.typing?"typing":"";var N=$('<li class="message"/>').data("username",L.username).addClass(K).append(O,Q);k(N,S)}else{if(L.username==l){responsiveVoice.speak(String(L.message.trim()));var R=document.getElementById("sc-widget"),M=SC.Widget(R);if(responsiveVoice.isPlaying()){M.setVolume(0.25)}else{M.setVolume(100)}}var O=$('<span class="username"/>').text(L.username).css("color",b(L.username));var Q=$('<span style="font-size: 1.1em" class="messageBody">').text(L.message);var K=L.typing?"typing":"";var N=$('<li class="message" style="text-align: left;"/>').data("username",L.username).addClass(K).append(O,Q);k(N,S)}}function F(J){J.typing=true;J.message="is typing";u(J)}function A(J){x(J).fadeOut(function(){$(this).remove()})}function k(L,J){var K=$(L);if(!J){J={}}if(typeof J.fade==="undefined"){J.fade=true}if(typeof J.prepend==="undefined"){J.prepend=false}if(J.fade){K.hide().fadeIn(m)}if(J.prepend){d.prepend(K)}else{d.append(K)}d[0].scrollTop=d[0].scrollHeight}function p(J){return $("<div/>").text(J).text()}function o(){if(I){if(!G){G=true;s.emit("typing")}B=(new Date()).getTime();setTimeout(function(){var J=(new Date()).getTime();var K=J-B;if(K>=j&&G){s.emit("stop typing");G=false}},j)}}function x(J){return $(".typing.message").filter(function(K){return $(this).data("username")===J.username})}function b(M){var L=7;for(var K=0;K<M.length;K++){L=M.charCodeAt(K)+(L<<5)-L}var J=Math.abs(L%t.length);return t[J]}w.keydown(function(J){if(J.which===13){if(i){g();s.emit("stop typing");G=false}else{r()}}});z.on("input",function(){o()});e.click(function(){});z.click(function(){z.focus()});s.on("login",function(K){I=true;var J="Welcome, you are in "+K.room;n(J,{prepend:true});D(K)});updateRooms=function(K){for(var J in Object.keys(K.rooms)){if((K.rooms)[Object.keys(K.rooms)[J]].users.length!=0){C.append(($("<li style=padding-top:1em;cursor:pointer;background-color:"+b(Object.keys(K.rooms)[J])+">"+Object.keys(K.rooms)[J]+" <span class='glyphicon glyphicon-user' aria-hidden='true'> </span> <span class='badge'>"+Object.keys((K.rooms[Object.keys(K.rooms)[J]]).users).length+"</span></li>").bind("click",function(){updateRoom(this.textContent)})))}}};getLocation=function(){$.ajax({url:"https://freegeoip.net/json/",crossDomain:true,type:"POST",dataType:"jsonp",success:function(J){window.localStorage.setItem("city",J.city);window.localStorage.setItem("region-code",J.region_code);window.localStorage.setItem("region-name",J.region_name);window.localStorage.setItem("areacode",J.areacode);window.localStorage.setItem("ip",J.ip);window.localStorage.setItem("longitude",J.longitude);window.localStorage.setItem("latitude",J.latitude);window.localStorage.setItem("country-name",J.country_name);window.localStorage.setItem("country-code",J.country_code)}})};s.on("getRooms",function(K){getLocation();updateRooms(K);var J=selectRandomRoom(K);window.localStorage.setItem("rooms",J)});selectRandomRoom=function(L){var K;for(var J in Object.keys(L.rooms)){if((L.rooms)[Object.keys(L.rooms)[J]].users.length!=0){K=Object.keys(L.rooms)[Math.floor(Math.random()*(Object.keys(L.rooms)).length)]}}return K};updateRoom=function(J){var J=J.split("  ")[0];i=p(a.val().trim());roomname=p(J.trim());if(i){e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}else{i="Anonymous User ";e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}};peopleNearMe=function(){var J=window.localStorage.getItem("city");if(J==""){J=window.localStorage.getItem("country-name")}i=p(a.val().trim());roomname=p(J.trim());if(i){e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}else{i="Anonymous User ";e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}};trustYourDestiny=function(){var J=window.localStorage.getItem("rooms");i=p(a.val().trim());roomname=p(J.trim());if(i){e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}else{i="Anonymous User ";e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}};peopleNotSoNearMe=function(){var J=window.localStorage.getItem("region-name");if(J==""){J=window.localStorage.getItem("country-name")}i=p(a.val().trim());roomname=p(J.trim());if(i){e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}else{i="Anonymous User";e.fadeOut();H.show();e.off("click");c=z.focus();s.emit("setRoom",roomname);s.emit("add user",i)}};s.on("play_music",function(J){if(J.play==true){h.setVolume(J.setVolume);h.play()}else{if(J.next==true){h.setVolume(J.setVolume);h.next()}else{if(J.prev==true){h.setVolume(J.setVolume);h.prev()}else{if(J.pause==true){h.setVolume(J.setVolume);h.pause()}else{h.setVolume(J.setVolume);h.pause()}}}}});s.on("new message",function(J){u(J)});s.on("user joined",function(J){n(J.username+" joined "+J.room);D(J)});s.on("user left",function(J){n(J.username+" left "+J.room);if(J.numUsers==0){window.localStorage.removeItem(J.room)}D(J);A(J)});s.on("typing",function(J){F(J)});s.on("stop typing",function(J){A(J)})});